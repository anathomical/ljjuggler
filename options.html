<html>
	<head>
		<title>Account Juggler - Options</title>
		<script type="text/javascript" src="md5.js"></script>
		<script type="text/javascript">
function drawlist()
{
	var account_list;
	if(localStorage["lj_juggler_accounts"]) account_list = JSON.parse(localStorage["lj_juggler_accounts"]);
	else account_list = new Array;
	account_list.sort(accountsort);
	document.getElementById("account-list").innerHTML = "";
	
	for(var i = 0; i < account_list.length; i++)
	{
		var account = account_list[i];
		var next_account = document.createElement("li");
		var delete_button = document.createElement("button");
		delete_button.id = account.username;
		delete_button.onclick = delete_clicker(account);
		delete_button.innerHTML = "delete";
		next_account.innerHTML = account.username;
		next_account.appendChild(delete_button);
		document.getElementById("account-list").appendChild(next_account);
	}
	document.getElementById("username").focus();
}
function delete_clicker (account)
{
	return function () { delete_account(account.username) };
}
function delete_account(username)
{
	account_list = JSON.parse(localStorage["lj_juggler_accounts"]);
	for (var i = 0; account_list[i]; i++)
	{
		if (account_list[i].username == username)
		{
			account_list.splice(i, 1);
			localStorage["lj_juggler_accounts"] = JSON.stringify(account_list);
			break;
		}
	}
	drawlist();
}
function save_new_account()
{
	username = document.getElementById("username").value;
	password = md5(document.getElementById("password").value);
	if(username && password)
	{
		var account_list;
		if(localStorage["lj_juggler_accounts"]) account_list = JSON.parse(localStorage["lj_juggler_accounts"]);
		else account_list = [];
		account_to_add = {"username":username,"password":password};
		account_list.push(account_to_add);
		localStorage["lj_juggler_accounts"] = JSON.stringify(account_list);
		drawlist();
	}
	document.getElementById("username").value = "";
	document.getElementById("password").value = "";
	return false;
}
function accountsort(account_one, account_two)
{
	if(account_one.username == account_two.username) return 0;
	else if(account_one.username < account_two.username) return -1;
	else if(account_one.username > account_two.username) return 1;
}
		</script>
	</head>
	<body onload="drawlist();">
		<h3>Accounts:</h3>
		<ul id="account-list">
		</ul>
		<h3>Add new account:</h3>
		<form onsubmit="return save_new_account();">
			Username: <input type="text" id="username"/><br/>
			Password: <input type="password" id="password"/><br/>
			<input type="submit" value="Add">
		</form>
	</body>
</html>